<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Generate PDF</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
<h2>Generate PDF</h2>
<button onclick="gen()">Generate & Send</button>

<script>
const { jsPDF } = window.jspdf;
const data = JSON.parse(sessionStorage.getItem('data'));

function gen(){
 const doc = new jsPDF();
 doc.text('DCA STATEMENT',20,20);
 doc.text('Nama: '+data.nama,20,35);
 doc.text('Akaun: '+data.akaun,20,45);
 const pdfBlob = doc.output('blob');
 const reader = new FileReader();
 reader.onloadend = async ()=>{
  const base64 = reader.result.split(',')[1];
  const payload = {...data, pdf_base64:base64, pdf_name:'Statement_'+data.akaun+'.pdf'};

  const res = await fetch('https://script.google.com/macros/s/AKfycbyduxJYgFT0iTtjwJO7LODVZ-s24TC5PWN_uR5CDPtQljPtRvOQOB5soZ70KUiK31xfzg/exec',{
    method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload)
  });
  const j = await res.json();
  if(j.status==='OK'){
    doc.save('Statement_'+data.akaun+'.pdf');
  }else{
    alert('KEY INVALID / ERROR');
  }
 };
 reader.readAsDataURL(pdfBlob);
}
</script>
</body>
</html>
